require=function n(c,s,a){function l(t,e){if(!s[t]){if(!c[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(h)return h(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=s[t]={exports:{}};c[t][0].call(o.exports,function(e){return l(c[t][1][e]||e)},o,o.exports,n,c,s,a)}return s[t].exports}for(var h="function"==typeof require&&require,e=0;e<a.length;e++)l(a[e]);return l}({Alert:[function(e,t,i){"use strict";cc._RF.push(t,"c6a8fRZogRMEoiezwSh20jW","Alert"),cc.Class({extends:cc.Component,properties:{},start:function(){},enterCB:function(){cc.director.loadScene("Game")}}),cc._RF.pop()},{}],Board:[function(e,t,i){"use strict";cc._RF.push(t,"4a466EjV7tPA6b0e4+H77EJ","Board");var r,p=e("Config"),o=e("./util/Util"),f=(r=o)&&r.__esModule?r:{default:r};var n=0;cc.Class({extends:cc.Component,properties:{hexSide:5,tileH:110,tilePic:{default:null,type:cc.SpriteFrame}},start:function(){},onLoad:function(){this.setHexagonGrid(),this.node.on("dropSuccess",this.deleteTile,this),this.getOldScore()},getOldScore:function(){var e=cc.sys.localStorage.getItem("score");cc.find("Canvas/OldScore").getComponent(cc.Label).string=Number(e)},deleteTile:function(){var n=this,e=[],t=[],i=this.boardFrameList;this.isDeleting=!0,this.addScore(this.curTileLength,!0);for(var r=0;r<i.length;r++){i[r].isFulled&&e.push(r)}for(var o=0;o<p.DelRules.length;o++){var c=p.DelRules[o],s=f.default.arrIntersect(e,c);if(0<s.length)f.default.checkArrIsEqual(c,s)&&t.push(c)}for(var a=0,l=0;l<t.length;l++)for(var h=t[l],d=function(e){var t=h[e],i=n.boardFrameList[t],r=i.getChildByName("fillNode");i.isFulled=!1;var o=cc.callFunc(function(){r.getComponent(cc.Sprite).spriteFrame=null,r.opacity=255,a++},n);r.runAction(cc.sequence(cc.fadeOut(.3),o))},u=0;u<h.length;u++)d(u);0!==a&&(this.addScore(a),this.checkLose()),this.isDeleting=!1},addScore:function(e,t){var i=this.scoreRule(e,t),r=cc.find("Canvas/Score").getComponent(cc.Label);r.string=i+Number(r.string),n=Number(r.string)},scoreRule:function(e,t){var i=e+1;return t?i:2*i*i},checkLose:function(){if(!this.isDeleting){for(var e=this.node.parent.getChildByName("TileContainer").children,t=e.length,i=0,r=0;r<t;r++){var o=e[r];o.getComponent("Shape").checkLose()?(i++,o.opacity=125):o.opacity=255}if(3===i)cc.sys.localStorage.getItem("score")<n&&cc.sys.localStorage.setItem("score",n),this.gameOver()}},gameOver:function(){var e=cc.find("Canvas/Failed");e.active=!0,e.runAction(cc.fadeIn(.3))},setHexagonGrid:function(){var t=this;this.hexes=[],this.boardFrameList=[],this.hexSide--;for(var e=-this.hexSide;e<=this.hexSide;e++)for(var i=Math.max(-this.hexSide,-e-this.hexSide),r=Math.min(this.hexSide,-e+this.hexSide),o=i;o<=r;o++){var n=e+this.hexSide,c=o-i;this.hexes[n]||(this.hexes[n]=[]),this.hexes[n][c]=this.hex2pixel({q:e,r:o},this.tileH)}this.hexes.forEach(function(e){t.setSpriteFrame(e)})},hex2pixel:function(e,t){var i=t/2,r=i*Math.sqrt(3)*(e.q+e.r/2),o=3*i/2*e.r;return cc.p(r,o)},setSpriteFrame:function(e){for(var t=0;t<e.length;t++){var i=new cc.Node("frame");i.addComponent(cc.Sprite).spriteFrame=this.tilePic,i.x=e[t].x,i.y=e[t].y,i.parent=this.node,e[t].spriteFrame=i,this.setShadowNode(i),this.setFillNode(i),this.boardFrameList.push(i)}},setShadowNode:function(e){var t=new cc.Node("frame");t.addComponent(cc.Sprite),t.name="shadowNode",t.opacity=150,t.parent=e},setFillNode:function(e){var t=new cc.Node("frame");t.addComponent(cc.Sprite),t.name="fillNode",t.parent=e}}),cc._RF.pop()},{"./util/Util":"Util",Config:"Config"}],Config:[function(e,t,i){"use strict";cc._RF.push(t,"6c90aUK/DBJtZGoJqW6BWXM","Config"),Object.defineProperty(i,"__esModule",{value:!0});i.default={DelRules:[[0,1,2,3,4],[5,6,7,8,9,10],[11,12,13,14,15,16,17],[18,19,20,21,22,23,24,25],[26,27,28,29,30,31,32,33,34],[35,36,37,38,39,40,41,42],[43,44,45,46,47,48,49],[50,51,52,53,54,55],[56,57,58,59,60],[26,35,43,50,56],[18,27,36,44,51,57],[11,19,28,37,45,52,58],[5,12,20,29,38,46,53,59],[0,6,13,21,30,39,47,54,60],[1,7,14,22,31,40,48,55],[2,8,15,23,32,41,49],[3,9,16,24,33,42],[4,10,17,25,34],[0,5,11,18,26],[1,6,12,19,27,35],[2,7,13,20,28,36,43],[3,8,14,21,29,37,44,50],[4,9,15,22,30,38,45,51,56],[10,16,23,31,39,46,52,57],[17,24,32,40,47,53,58],[25,33,41,48,54,59],[34,42,49,55,60]],Tiles:[{type:1,list:[[[0,0]]]},{type:2,list:[[[1,-1],[0,0],[1,0],[0,1]],[[0,0],[1,0],[-1,1],[0,1]],[[0,0],[1,0],[0,1],[1,1]]]},{type:3,list:[[[0,-1],[0,0],[0,1],[0,2]],[[0,0],[1,-1],[-1,1],[-2,2]],[[-1,0],[0,0],[1,0],[2,0]]]},{type:4,list:[[[0,0],[0,1],[0,-1],[-1,0]],[[0,0],[0,-1],[1,-1],[-1,1]],[[0,0],[0,1],[0,-1],[1,0]],[[0,0],[1,0],[-1,0],[1,-1]],[[0,0],[1,0],[-1,0],[-1,1]]]},{type:5,list:[[[0,0],[0,1],[0,-1],[1,-1]],[[0,0],[1,-1],[-1,1],[-1,0]],[[0,0],[1,-1],[-1,1],[1,0]],[[0,0],[1,0],[-1,0],[0,-1]],[[0,0],[1,0],[-1,0],[0,1]]]},{type:6,list:[[[0,-1],[-1,0],[-1,1],[0,1]],[[-1,0],[0,-1],[1,-1],[1,0]],[[0,-1],[1,-1],[1,0],[0,1]],[[-1,1],[0,1],[1,0],[1,-1]],[[-1,0],[-1,1],[0,-1],[1,-1]],[[-1,0],[-1,1],[0,1],[1,0]]]}]},t.exports=i.default,cc._RF.pop()},{}],Shape:[function(e,t,i){"use strict";cc._RF.push(t,"4063413ziFJ573EdtZfBjyf","Shape");var r,o=e("Board"),n=(r=o)&&r.__esModule?r:{default:r},c=e("Config");var s=function(e,t){var i=cc.random0To1();return e+Math.floor((t-e)*i)};cc.Class({extends:cc.Component,properties:{tileH:122,tileScale:.7,board:{default:null,type:n.default},type1:{default:null,type:cc.SpriteFrame},type2:{default:null,type:cc.SpriteFrame},type3:{default:null,type:cc.SpriteFrame},type4:{default:null,type:cc.SpriteFrame},type5:{default:null,type:cc.SpriteFrame},type6:{default:null,type:cc.SpriteFrame}},onLoad:function(){this.setTile(),this.addTouchEvent()},setTile:function(){var t=this;this.tiles=c.Tiles;var e=this.random(),i=e.list.map(function(e){return t.hex2pixel(e,t.tileH)});this.setSpriteFrame(i,this["type"+e.type]),this.node.scale=this.tileScale,this.node.ox=this.node.x,this.node.oy=this.node.y},random:function(){var e=this.tiles[s(0,this.tiles.length)],t=e.list[s(0,e.list.length)];return{type:e.type,list:t}},hex2pixel:function(e,t){var i=t/2,r=i*Math.sqrt(3)*(e[0]+e[1]/2),o=3*i/2*e[1];return cc.p(r,o)},setSpriteFrame:function(e,t){for(var i=0;i<e.length;i++){var r=new cc.Node("frame");r.addComponent(cc.Sprite).spriteFrame=t,r.x=e[i].x,r.y=e[i].y,r.parent=this.node}},addTouchEvent:function(){var o=this;this.node.on("touchstart",function(e){o.node.setScale(1),o.node.children.forEach(function(e){e.setScale(.8)}),o.boardTiles=[],o.fillTiles=[]}),this.node.on("touchmove",function(e){var t=e.touch.getDelta(),i=t.x,r=t.y;o.node.x+=i,o.node.y+=r,o.checkCollision(e),o.checkCanDrop()?o.dropPrompt(!0):o.dropPrompt(!1)}),this.node.on("touchend",function(){o.tileDrop()}),this.node.on("touchcancel",function(){o.tileDrop()})},tileDrop:function(){if(this.resetBoardFrames(),this.checkCanDrop()){for(var e=this.boardTiles,t=this.fillTiles,i=t.length,r=0;r<i;r++){var o=e[r],n=t[r],c=o.getChildByName("fillNode"),s=n.getComponent(cc.Sprite).spriteFrame;o.isFulled=!0,c.getComponent(cc.Sprite).spriteFrame=s,this.resetTile()}this.board.curTileLength=t.length,this.board.node.emit("dropSuccess")}else this.backSourcePos();this.board.checkLose()},checkLose:function(){for(var e=0,t=this.node.children,i=t.length,r=this.board.boardFrameList,o=r.length,n=0;n<o;n++){var c=r[n],s=cc.p(c.x,c.y),a=0;if(!c.isFulled){for(var l=0;l<i;l++)for(var h=cc.pAdd(s,cc.p(t[l].x,t[l].y)),d=0;d<o;d++){var u=r[d];cc.pDistance(cc.p(u.x,u.y),h)<=27&&!u.isFulled&&a++}a===i&&e++}}return 0===e},resetTile:function(){this.node.removeAllChildren(),this.node.x=this.node.ox,this.node.y=this.node.oy,this.setTile()},backSourcePos:function(){this.node.scale=this.tileScale,this.node.x=this.node.ox,this.node.y=this.node.oy,this.node.children.forEach(function(e){e.setScale(1)})},checkCollision:function(e){var t=this.node.children;this.boardTiles=[],this.fillTiles=[];for(var i=0;i<t.length;i++){var r=t[i],o=cc.pAdd(this.node.position,r.position),n=this.checkDistance(o);n&&(this.fillTiles.push(r),this.boardTiles.push(n))}},checkDistance:function(e){for(var t=this.board.boardFrameList,i=0;i<t.length;i++){var r=t[i];if(cc.pDistance(r.position,e)<=50)return r}},checkCanDrop:function(){var e=this.boardTiles,t=this.node.children,i=e.length,r=t.length;if(0===i||i!=r)return!1;for(var o=0;o<i;o++)if(this.boardTiles[o].isFulled)return!1;return!0},resetBoardFrames:function(){for(var e=this.board.boardFrameList,t=0;t<e.length;t++){e[t].getChildByName("shadowNode").opacity=0}},dropPrompt:function(e){var t=this.boardTiles,i=t.length,r=this.fillTiles;if(this.resetBoardFrames(),e)for(var o=0;o<i;o++){var n=t[o].getChildByName("shadowNode");n.opacity=100;var c=r[o].getComponent(cc.Sprite).spriteFrame;n.getComponent(cc.Sprite).spriteFrame=c}},start:function(){}}),cc._RF.pop()},{Board:"Board",Config:"Config"}],Util:[function(e,t,i){"use strict";cc._RF.push(t,"0f151PisGVJAKNTI3GsmFYp","Util"),Object.defineProperty(i,"__esModule",{value:!0});i.default={arrIntersect:function(e,t){for(var i=[],r=0;r<e.length;r++)for(var o=0;o<t.length;o++)t[o]==e[r]&&i.push(t[o]);return i},checkArrIsEqual:function(e,t){for(var i=0;i<e.length;i++)if(t[i]!=e[i])return!1;return!0}},t.exports=i.default,cc._RF.pop()},{}]},{},["Alert","Board","Config","Shape","Util"]);