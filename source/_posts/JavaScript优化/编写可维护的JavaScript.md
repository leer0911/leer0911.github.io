---
title: 编写可维护的JavaScript
---

## 基本格式化

- 当一行字符数超出最大限制时，在运算符后换行，并增加两个层级的缩进(80个字符)
- 适当增加空行，让代码看起来像一系列可读段落。
- 小驼峰命名myName。
- 变量应当是以名词为前缀myName，尽量在变量命名中体现数据类型。函数以动词为前缀getName，can，has，is，get，set。
- 常量使用大写字母加下划线组成，下划线用来分隔单词。
- 构造函数用大驼峰命名，并以名词为前缀，代表创建实例。
- 字符串用双括号括起来。
- 不要忽略小数点前后的数字。
- 初始化对象时使用null，返回值期望为对象时也可以使用null。
- 不要用null来检测是否传入了某个参数，不要用null来检测一个未初始化的变量。
- 禁止使用特殊值undefined。
- 当代码很明了时不需要添加注释，相反则需要。浏览器特性HACK及可能被误认为错误的代码也需要添加注释。
- 文档注释JSDoc或者YUIDoc。

## 语句和表达式

- 所有的块语句都应当使用双花括号，推荐使用左侧花括号在首行末尾。
- switch语句在没有默认行为且标有注释情况下可省略default。
- 禁止使用with语句。尽量不使用continue。
- 建议在使用forin循环时，要使用hasOwnProperty来避免遍历原型链上的属性。如果真需要访问原型链上的属性，需要加注释。
- forin不应当用来遍历数组。
- 将局部变量的定义作为函数的第一条语句。当变量间存在联系时，可以使用单var语句。没有初始值的变量应放在尾部。
- 函数声明应提前且在变量声明之后，函数声明不应出现在语句块之内。
- 将立即调用函数返回的对象赋值给变量时，推荐使用圆括号包裹。
- 不建议在全局作用域中使用严格模式。
- 推荐使用全等和全不等`=== !==`。
- 禁止使用eval(),和Function。
- 禁止使用包装类型，Boolean，String，Number。

## UI层的松耦合

- 将JavaScript从css中抽离。
- 将CSS从JavaScript中分离。操作className
- 使用模板来将HTML和JavaScript分离。

## 事件处理

- 将应用逻辑从所有事件处理程序中抽离出来。
- 调用功能性代码最好的做法就是调用单个函数。
- 应用逻辑不应当依赖于event对象来完成功能。
- 当处理事件时，最好的方法是让事件程序成为唯一接触event对象的函数。事件处理程序应当在进入应用程序之前完成对event对象的操作。包括阻止默认事件或阻止冒泡。

## 避免空比较

- 检测原始值时使用typeof，字符串，数字，布尔值，undefined。null一般不用于检测语句。检测null建议用`=== !==`。
- 检测引用类型使用instanceof，对于函数和数组一般用不着使用instanceof。
- 一般使用typeof来检测函数，但是检测dom中的方法，一般使用in运算符。
- 检测数组可使用鸭式辨型，建议使用`Object.prototype.toString().call(value) === '[object Array]'`。
- 判断属性是否存在最好的方法是使用in运算符。判断实例属性时可使用hasOwnProperty。
- 配置数据是可发生变更的数据。

## 将配置数据从JavaScript中分离出来

- props2js

## 抛出自定义错误

- 在JavaScript中抛出错误是一种艺术。
- try，catch，finally。不要将catch留空。

## 最好的对象扩充形式是继承

- 基于对象的继承，Object中的create。基于类型的继承。依赖于构造函数。
- 适配器模式也非常不错。

## 浏览器嗅探

- 浏览器特性检测
