---
title: 《JS高级程序》事件[3]
date: 2016-12-7
---
## 事件类型
DOM3级事件规定了以下几类事件:
 * UI事件，当用户与页面上的元素交互时触发;
 * 焦点事件，当元素获得或失去焦点时触发;
 * 鼠标事件，当用户通过鼠标在页面上执行操作时触发;
 * 滚轮事件，当使用鼠标滚轮是触发;
 * 文本事件，当在文档中输入文本是触发;
 * 键盘事件，当用户通过键盘在页面上执行操作时触发;
 * 合成事件，当IME(Input Method Editor，输入法编辑器)输入字符时触发;
 * 变动(mutation)事件，当底层DOM结构发生变化时触发。
 * 变动名称事件，当元素或属性名变动时触发。此类事件已经被废弃。
除了这几类事件之外，HTML5页定义了一组事件，而有些浏览器还会在DOM和BOM中实现其他专有事件。

 * ### UI事件
 UI事件指的是那些不一定与用户操作有关的事件。
  * load:当页面完全加载后再window上触发
  ```js
    // <img src="" onload="alert("a")"/> 为图像添加load事件

  ```
  * unload:当页面完全卸载后再window上面触发，用户从一个页面切换到另一个页面，就会发生unload事件。而利用这个事件最多的情况就是清除引用，以免内存泄漏。
  * abort:当用户停止下载过程时
  * error:当发生JavaScript错误时在window上面触发



  * resize:当窗口或框架的大小发生变化时，浏览器窗口最小或最大化时也会触发resize事件。
  * scroll:当用户滚动带滚动条的元素中的内容时，在该元素上面触发。

* ### 焦点事件
document.hasFocus()方法及document.activeElement属性配合可以知晓用户在页面上的行踪。有以下6个焦点事件。
 * blur 在元素失去焦点时触发。这个事件不会冒泡;所有浏览器都支持它。
 * focus 在元素获得焦点时触发。这个事件不会冒泡;所有浏览器都支持它。
 * focusin 在元素获得焦点时触发。这个事件与HTML事件focus等价，但会冒泡;
 * focusout 在元素失去焦点时触发。这个事件是HTML事件blur的通用版。

* ### 鼠标和滚轮事件
DOM3级事件中定义了9个鼠标事件:
 * click:在用户单击鼠标主鼠标按钮(一般是左边的按钮)或者按下回车键时触发。这一点对确保易访问性很重要，意味着onclick事件处理程序既可以通过键盘也可以通过鼠标执行。
 * dbclick:双击时触发。
 * mousedown:在用户按下了任意鼠标按钮时触发。不能通过键盘触发这个事件。
 * mouseenter:在鼠标光标从元素外部首次移动到元素范围之内时触发。这个事件不冒泡，而且在光标移动到后代元素上不会触发。
 * mouseleave:在位于元素上方的鼠标移动到元素范围之外时触发。这事件不会冒泡。
 * mousemove:当鼠标指针在元素内部移动时重复触发。不能通过键盘触发这个事件。
 * mouseout:在鼠标指针位于一个元素上方，然后用户将其移入另一个元素时触发。
 * mouseover:在鼠标指针位于一个元素外部，然后用户将其首次移入另一个元素边界之内时触发。
 * mouseup:用户在释放鼠标按钮时触发，不能通过键盘触发。
页面上所有元素都支持鼠标事件。除了mouseenter和mouseleave，所有鼠标事件都会冒泡，也可以被取消，而取消鼠标事件将影响浏览器的默认行为。取消鼠标事件的默认行为会影响其他事件。只有在同一个元素上相继触发mousedown和mouseup事件，才会触发click事件;如果mousedown或mouseup中的一个被取消，就不会触发click事件。
鼠标事件都是在浏览器视口中的特定位置上发生的。这个位置信息保存在事件对象的clientX和clientY属性中。所有浏览器都支持这两个属性，它们的值表示事件发生时鼠标指针在视口中的水平位置和垂直位置。
```js
  var div = document.getElementById("myDiv");
  EventUtil.addHandler(div,"click",function(event){
    event = EventUtil.getEvent(event);
    alert("Client coordinates:"+event.clientX+","+event.clientY);
  })
```
通过pageX和pageY属性可以告诉你事件是在页面中声明位置发生的。这两个属性表示鼠标光标在页面中的位置。因此左边是从页面本身而非视口的左边和定边计算的。在页面没有滚动的情况下pageX和pageY的值与clientX和clientY的值相等。
```js
  var div = document.getElementById("myDiv");
  EventUtil.addHandler(div,"click",function(event){
    event = EventUtil.getEvent(event);
    var pageX = event.pageX;
    var pageY = event.pageY;
    if(pageX === undefined){
      pageX = event.clientX + (document.body.scrollLeft || document.documentElement.scrollLeft);
    }
    if(pageY === undefined){
      pageY = event.clientY + (document.body.scrollTop || document.documentElement.scrollTop);
    }
    alert("page coordinates:" + pageX + "," + pageY);
  });
```
屏幕坐标位置:鼠标事件发生时，不仅会有相对于浏览器窗口的位置，还有一个相对于整个电脑屏幕的位置。而通过screenX和screenY属性就可以确定鼠标事件发生时鼠标指针相对于整个屏幕的坐标信息。使用下面的代码取得鼠标事件的屏幕坐标:
```js
var div = document.getElementById("myDiv");
EventUtil.addHandler(div,"click",function(event){
  event = EventUtil.getEvent(event);
  alert("Client coordinates:"+event.screenX+","+event.screenY);
})
```
修改键:DOM规定了4个属性表示这些修改键的状态:shiftKey、ctrlKey、altKey和metaKey。
```js
var div = document.getElementById("myDiv");
EventUtil.addHandler(div, "click", function(event) {
    event = EventUtil.getEvent(event);
    var keys = new Array();
    if (event.shiftKey) {
        keys.push("shift");
    }
    if (event.ctrlKey) {
        keys.push("ctrl");
    }
    if (event.altKey) {
        keys.push("alt");
    }
    if (event.metaKey) {
        keys.push("meta");
    }
    alert("Keys: " + keys.join(","));
});
```
相关元素:DOM通过event对象的relatedTarget属性提供了相关元素的信息。这个属性只对于mouseover和mouseout事件才包含值;对于其他事件，这个属性的值是null。鼠标按钮:DOM的button属性可能有如下3个值:0表示主鼠标按钮，1表示中间的鼠标按钮(鼠标滚轮按钮)，2表示次鼠标按钮。
