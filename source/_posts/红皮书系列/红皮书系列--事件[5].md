---
title: 《JS高级程序》事件[5]
date: 2016-12-5
---
## 内存和性能
每个函数都是对象，都会占用内存;内存中的对象越多，性能就越差。
  * ### 事件委托
  对"事件处理程序过多"问题的解决方案就是事件委托。事件委托是利用了事件冒泡。只指定一个事件处理程序，就可以管理某一类型的所有事件。使用事件委托，只需要在DOM树中尽量最高的层次添加一个事件处理程序。
  ```js
  var list = document.getElementById("myLinks");
  EventUtil.addHandler(list, "click", function(event) {
      event = EventUtil.getEvent(event);
      var target = EventUtil.getTarget(event);
      switch (target.id) {
          case "doSomething":
              document.title = "I changed the document's title";
              break;
          case "goSomewhere":
              location.href = "http://www.wrox.com";
              break;
          case "sayHi":
              alert("hi");
              break;
      }
  });
  ```
 所有用到按钮的事件(多数鼠标事件和键盘事件)都适合采用事件委托技术。优点如下
 * document对象很快就可以访问到，而且可以在页面生命周期的任何时点上为它添加事件处理程序(无需等待DOMContentLoad或load事件)。只要可单击的元素呈现在页面上，就可以立即具备适当的功能。
 * 在页面中何止事件处理程序所需的事件更少。只添加一个事件处理程序所需的DOM引用更少，所花的时间也更少。
 * 整个页面占用的内存空间更少，能够提升整体的性能。
 最适合的事件有:click，mousedown，keydown，keyup，keypress。

 * ### 移除事件处理程序
 内存中留有过时不用的"空事件处理程序"也是造成web应用程序内存与性能问题的主要原因。在两种情况下可能造成这个问题:
  * 从文档中移除带有事件处理程序的元素时。例如使用innerHTML替换页面中的某一部分的时候。如果你知道某个元素即将被移除，那么最好手工移除事件处理程序，:
  ```html
    <div id="myDiv">
      <input type="button" value="Click Me" id="myBtn">
    </div>
    <script type="text/javascript">
      var btn = document.getElementById("myBtn");
      btn.onclick = function() {
          //先执行某些操作
          btn.onclick = null; //移除事件处理程序
          document.getElementById("myDiv").innerHTML = "Processing...";
      };
    </script>
  ```
 * 导致"空事件处理程序"的另一种情况，就是卸载页面的时候。

## 模拟事件
事件，就是网页中某个特别值得关注的瞬间。事件经常由用户操作或通过其他浏览器功能来触发。
 * DOM中的事件模拟
 可以在document对象上使用createEvent()方法创建Event对象。这个方法接收一个参数，即表示要创建事件类型的字符串。在DOM2级中为复数形式，而在DOM3级中都变成了单数。这些字符可以是下列字符之一:
  * UIEvents
  * MouseEvents
  * MutationEvents
  * HTMLEvents
 模拟事件的最后一步就是触发事件。这一步需要使用dispatchEvent()方法，所有支持事件的DOM节点都支持这个方法。需要传入一个参数，即表示要触发事件的event对象。

## 小结
事件是将JavaScript与网页联系在一起的主要方式。
 在使用事件时，需要考虑如下一些内存与性能方面的问题:
 * 有必要限制一个页面中事件处理程序的数量、数量太多会导致占用大量内存。
 * 简历在事件冒泡机制之上的事件委托技术，可以有效地减少事件处理程序的数量。
 ## 内存和性能
 每个函数都是对象，都会占用内存;内存中的对象越多，性能就越差。
   * ### 事件委托
   对"事件处理程序过多"问题的解决方案就是事件委托。事件委托是利用了事件冒泡。只指定一个事件处理程序，就可以管理某一类型的所有事件。使用事件委托，只需要在DOM树中尽量最高的层次添加一个事件处理程序。
   ```js
   var list = document.getElementById("myLinks");
   EventUtil.addHandler(list, "click", function(event) {
       event = EventUtil.getEvent(event);
       var target = EventUtil.getTarget(event);
       switch (target.id) {
           case "doSomething":
               document.title = "I changed the document's title";
               break;
           case "goSomewhere":
               location.href = "http://www.wrox.com";
               break;
           case "sayHi":
               alert("hi");
               break;
       }
   });
   ```
  所有用到按钮的事件(多数鼠标事件和键盘事件)都适合采用事件委托技术。优点如下
  * document对象很快就可以访问到，而且可以在页面生命周期的任何时点上为它添加事件处理程序(无需等待DOMContentLoad或load事件)。只要可单击的元素呈现在页面上，就可以立即具备适当的功能。
  * 在页面中何止事件处理程序所需的事件更少。只添加一个事件处理程序所需的DOM引用更少，所花的时间也更少。
  * 整个页面占用的内存空间更少，能够提升整体的性能。
  最适合的事件有:click，mousedown，keydown，keyup，keypress。

  * ### 移除事件处理程序
  内存中留有过时不用的"空事件处理程序"也是造成web应用程序内存与性能问题的主要原因。在两种情况下可能造成这个问题:
   * 从文档中移除带有事件处理程序的元素时。例如使用innerHTML替换页面中的某一部分的时候。如果你知道某个元素即将被移除，那么最好手工移除事件处理程序，:
   ```html
     <div id="myDiv">
       <input type="button" value="Click Me" id="myBtn">
     </div>
     <script type="text/javascript">
       var btn = document.getElementById("myBtn");
       btn.onclick = function() {
           //先执行某些操作
           btn.onclick = null; //移除事件处理程序
           document.getElementById("myDiv").innerHTML = "Processing...";
       };
     </script>
   ```
  * 导致"空事件处理程序"的另一种情况，就是卸载页面的时候。

 ## 模拟事件
 事件，就是网页中某个特别值得关注的瞬间。事件经常由用户操作或通过其他浏览器功能来触发。
  * DOM中的事件模拟
  可以在document对象上使用createEvent()方法创建Event对象。这个方法接收一个参数，即表示要创建事件类型的字符串。在DOM2级中为复数形式，而在DOM3级中都变成了单数。这些字符可以是下列字符之一:
   * UIEvents
   * MouseEvents
   * MutationEvents
   * HTMLEvents
  模拟事件的最后一步就是触发事件。这一步需要使用dispatchEvent()方法，所有支持事件的DOM节点都支持这个方法。需要传入一个参数，即表示要触发事件的event对象。
