---
title: 语句后是否需要分号
date: 2017-10-12 20:25:09
tags: JavaScript
---

该思考来自于阅读JavaScript高级程序建议语句后都加分号及Eslint中不建议带分号。

> 虽然语句结尾的分号不是必需的，但我们建议任何时候都不要省略它。因为加上这个分号可以避免 很多错误(例如不完整的输入)，开发人员也可以放心地通过删除多余的空格来压缩 ECMAScript 代码(代 码行结尾处没有分号会导致压缩错误)。另外，加上分号也会在某些情况下增进代码的性能，因为这样 解析器就不必再花时间推测应该在哪里插入分号了。 -- 引自JavaScript高程 3.1.5 语句

高程里说的增加性能实在难以服众，至于导致语法错误可以继续往下看。

[Standard](https://standardjs.com/readme-zhcn.html)建议无分号

[相关文章](http://inimino.org/~inimino/blog/javascript_semicolons)


另外，[尤大在知乎的说法](https://www.zhihu.com/question/20298345/answer/49551142)

> 没有应该不应该，只有你自己喜欢不喜欢。JavaScript 语法长得 C-like 不代表它本质上和 C 是一类语言，所有直觉性的 “当然应该加分号” 都是保守的、未经深入思考的草率结论。后来新设计的语言里可选分号的多得去了，光是 “可以加分号但是大家都不加” 的语言就有：Go, Scala, Ruby, Python, Swift, Groovy...

> 至于说 “很难总结什么时候加不加”，其实真的很简单。真正会导致上下行解析出问题的 token 有 5 个：括号，方括号，正则开头的斜杠，加号，减号。我还从没见过实际代码中用正则、加号、减号作为行首的情况，所以总结下来就是一句话：一行开头是括号或者方括号的时候加上分号就可以了，其他时候全部不需要。其实即使是这两种情况，在实际代码中也颇为少见。

尤大贡献的 [github commit hook](https://github.com/yyx990803/semi) 

可是由于无分号导致的，该代码运行错误

``` js
const a = 2

[ 3, 4 ].forEach(n => console.log(n))
```

## 什么是ASI

按照 ECMAScript 标准，一些 特定语句（statement) 必须以分号结尾。分号代表这段语句的终止。但是有时候为了方便，这些分号是有可以省略的。这种情况下解释器会自己判断语句该在哪里终止。这种行为被叫做 “自动插入分号”，简称 ASI (Automatic Semicolon Insertion) 。实际上分号并没有真的被插入，这只是个便于解释的形象说法。

这些特定的语句有：

* 空语句
* let
* const
* import
* export
* 变量赋值
* 表达式
* debugger
* continue
* break
* return
* throw

## ASI 规则

ECMAScript 标准定义的 ASI 包括 三条规则 和 两条例外。

三条规则是描述何时该自动插入分号：

* 解析器从左往右解析代码（读入 token），当碰到一个不能构成合法语句的 token 时，它会在以下几种情况中在该 token 之前插入分号，此时这个不合群的 token 被称为 offending token ：
    * 如果这个 token 跟上一个 token 之间有至少一个换行。
    * 如果这个 token 是 }。
    * 如果 前一个 token 是 )，它会试图把前面的 token 理解成 do...while 语句并插入分号。
* 当解析到文件末尾发现语法还是有问题，就会在文件末尾插入分号。
* 当解析时碰到 restricted production 的语法（比如 return），并且在 restricted production 规定的 [no LineTerminator here] 的地方发现换行，那么换行的地方就会被插入分号。


## 总结

至于高程说的可以避免错误，我觉得这些错误本身是应该改掉的编码习惯。而性能，对于现在的引擎来说应该可以忽略不计。

Eslint之所以提倡无分号，可能也是从另一个出发点来改掉编码者的不良习惯。

参考 http://cnodejs.org/topic/56dbbd25820d3c9b3d63e369