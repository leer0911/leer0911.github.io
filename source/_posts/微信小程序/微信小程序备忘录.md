---
title: 微信小程序
---

# 常用方法

## 获取父页面参数

```javascript
wx.navigateTo({
    url: '/pages/buy/location/location?skuId=' + this.data.skuId + '&locationId=' + this.data.locationId
})
onLoad: function (options) {
  // 页面初始化 options为页面跳转所带来的参数
  options.skuId;
  options.locationId;
}
```

## 设置page实例data值

```javascript
this.setData({
    locationId: locationId,
    address: address,
    phone: phone
  });
```

## 加载请求常用方法

```javascript
loadLock: false,
loadData:function () {
  var that = this;

  if (that.loadLock) {
    return;
  } else {
    that.loadLock = true;
  }

  wx.showToast({
    title: '加载中',
    icon: 'loading',
    duration: 10000
  });

  util.request({
    url: API.getSkuMsgUrl(skuId),
    success: function (res) {
      if (res.data.success) {

      }
    },
    complete:function () {
      that.loadLock = false;
      wx.hideToast();
      wx.stopPullDownRefresh();
    }
  });
},
onPullDownRefresh: function () {
        this.loadData();
},
```

## 公共接口

```javascript
const REQUEST_HOST = '';

function getLocationUrl(locationId){
  return REQUEST_HOST + '/user/locations/'+locationId;
}

module.exports = {
  host: REQUEST_HOST,
  apiUrl: REQUEST_HOST,
  indexUrl: REQUEST_HOST + '/index',
  getLocationUrl: getLocationUrl
}

// 调用
var API = require('../../../utils/api.js')
var util = require('../../../utils/util.js')
```

## 获取父页面

```javascript
/**
 * 获取父页面
 * @returns {*}
 */
function getParentPage() {
  var pages = getCurrentPages();
  if(pages.length > 1) {
    return pages[pages.length - 2];
  } else {
    return null;
  }
}
```

## 网络请求方法

```javascript
/**
* 网络请求方法
* @param obj
*/
function request(obj) {
  wx.request({
    url: obj.url,
    data: obj.data || {},
    method: obj.method || 'GET',
    header: headerHander(obj),
    success: function(res) {
      console.log(res);
      typeof obj.success == "function" && obj.success(res);
      if(!res.data.success) {
        errorHander(res.data);
        console.warn(res.data);
      }
    },
    fail: function() {
      typeof obj.fail == "function" && obj.fail();
    },
    complete: function() {
      typeof obj.complete == "function" && obj.complete();
    }
  })
}
/**
* Header处理器
* @param obj
* @returns {header}
*/
function headerHander(obj) {
  var header = obj.header || {}
  if(!header['Content-Type']) {
    header['Content-Type'] = 'application/json'
  }
  if(!header['HK-Auth-SessionId']) {
    header['HK-Auth-SessionId'] = getSessionId();
  }
  if(!header['HK-Location-CityCode']) {
    header['HK-Location-CityCode'] = getCityCode();
  }
  return header;
}
```

## 可用三元表达式动态绑定class

```html
<view wx:if="{{item.stock <= 0 ? false : true}}" bindtap="selectTime"class="time-box {{serviceTime==item.time?'is-selected':''}}" id="{{item.time}}">{{item.text}}</view>
```
